<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Firestore Users Admin Panel</title>
  <style>
    /* Global & form styles omitted for brevity - same as yours */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      max-width: 700px;
      margin: auto;
      background: linear-gradient(135deg, #e3f2fd, #ffffff);
      color: #333;
    }
    h1, h2 {
      text-align: center;
      color: #1565c0;
      margin-bottom: 24px;
      font-weight: 600;
    }
    form {
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    input, button {
      padding: 8px 12px;
      font-size: 1rem;
      border-radius: 6px;
    }
    input {
      flex-grow: 1;
      border: 1.5px solid #90caf9;
    }
    input:focus {
      outline: none;
      border-color: #1e88e5;
      box-shadow: 0 0 8px rgba(30, 136, 229, 0.3);
    }
    button {
      cursor: pointer;
      border: none;
      background: #1e88e5;
      color: white;
      font-weight: 600;
      transition: 0.3s;
    }
    button:hover:not(:disabled) {
      background-color: #1565c0;
    }
    button:disabled {
      background: #90caf9;
      cursor: default;
    }

    table {
      width: 100%;
      margin-top: 10px;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(21, 101, 192, 0.15);
    }
    th, td {
      padding: 12px 16px;
      border-bottom: 1px solid #e3f2fd;
      text-align: left;
    }
    th {
      background-color: #1e88e5;
      color: white;
    }
    tr:hover:not(.editing) {
      background-color: #e3f2fd;
    }

    .actions button {
      margin-right: 6px;
    }

    #viewer div {
      margin-bottom: 10px;
      padding: 10px;
      background: #f1f8ff;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(30, 136, 229, 0.1);
    }

    @media (max-width: 500px) {
      form {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <h1>Firestore Users Admin Panel</h1>

  <form id="addUserForm">
    <input type="text" id="nameInput" placeholder="Name" required />
    <input type="email" id="emailInput" placeholder="Email" required />
    <input type="password" id="passwordInput" placeholder="Password" required />
    <button type="submit">Add User</button>
  </form>

  <table>
    <thead>
      <tr><th>Name</th><th>Email</th><th>Actions</th></tr>
    </thead>
    <tbody id="usersTableBody">
      <tr><td colspan="3" style="text-align:center;">Loading users...</td></tr>
    </tbody>
  </table>

  <h2>Public View</h2>
  <div id="viewer">Loading users...</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      addDoc,
      deleteDoc,
      doc,
      updateDoc
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import {
      getAuth,
      createUserWithEmailAndPassword
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD_U99buNllSjffSb2bcJxyJeEloXJux3o",
      authDomain: "homeglow-4b33c.firebaseapp.com",
      projectId: "homeglow-4b33c",
      storageBucket: "homeglow-4b33c.appspot.com",
      messagingSenderId: "294005891011",
      appId: "1:294005891011:web:6b71c2e3978ac646d62776",
      measurementId: "G-67LHBFRVD3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const addUserForm = document.getElementById('addUserForm');
    const nameInput = document.getElementById('nameInput');
    const emailInput = document.getElementById('emailInput');
    const passwordInput = document.getElementById('passwordInput');
    const usersTableBody = document.getElementById('usersTableBody');
    const viewer = document.getElementById('viewer');

    async function loadUsers() {
      usersTableBody.innerHTML = `<tr><td colspan="3" style="text-align:center;">Loading users...</td></tr>`;
      viewer.innerHTML = `Loading users...`;
      try {
        const snapshot = await getDocs(collection(db, 'users'));
        usersTableBody.innerHTML = '';
        viewer.innerHTML = '';

        if (snapshot.empty) {
          usersTableBody.innerHTML = `<tr><td colspan="3" style="text-align:center;">No users found.</td></tr>`;
          viewer.innerHTML = `<p>No users found.</p>`;
          return;
        }

        snapshot.forEach(docSnap => {
          const user = docSnap.data();
          const id = docSnap.id;

          // Admin Table Row
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="name">${user.name || ''}</td>
            <td class="email">${user.email || ''}</td>
            <td class="actions">
              <button class="edit-btn" data-id="${id}">Edit</button>
              <button class="delete-btn" data-id="${id}">Delete</button>
            </td>`;
          usersTableBody.appendChild(tr);

          // Viewer
          const div = document.createElement('div');
          div.innerHTML = `<strong>${user.name}</strong> - ${user.email}`;
          viewer.appendChild(div);
        });

        attachEventListeners();
      } catch (error) {
        console.error("Error loading users:", error);
        usersTableBody.innerHTML = `<tr><td colspan="3" style="color:red; text-align:center;">Failed to load users.</td></tr>`;
        viewer.innerHTML = `<p style="color:red;">Failed to load users.</p>`;
      }
    }

    function attachEventListeners() {
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.onclick = async () => {
          const id = btn.getAttribute('data-id');
          if (confirm('Are you sure you want to delete this user?')) {
            await deleteDoc(doc(db, 'users', id));
            await loadUsers();
          }
        };
      });

      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.onclick = () => {
          const tr = btn.closest('tr');
          const deleteBtn = tr.querySelector('.delete-btn');
          const nameCell = tr.querySelector('td.name');
          const emailCell = tr.querySelector('td.email');

          if (btn.textContent === 'Edit') {
            nameCell.innerHTML = `<input type="text" value="${nameCell.textContent}" />`;
            emailCell.innerHTML = `<input type="email" value="${emailCell.textContent}" />`;
            btn.textContent = 'Save';
            deleteBtn.textContent = 'Cancel';
          } else if (btn.textContent === 'Save') {
            const newName = nameCell.querySelector('input').value.trim();
            const newEmail = emailCell.querySelector('input').value.trim();
            const id = btn.getAttribute('data-id');

            if (!newName || !newEmail) {
              alert("Name and Email are required.");
              return;
            }

            updateDoc(doc(db, 'users', id), { name: newName, email: newEmail }).then(loadUsers);
          } else {
            loadUsers();
          }
        };
      });
    }

    addUserForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = nameInput.value.trim();
      const email = emailInput.value.trim();
      const password = passwordInput.value;

      if (!name || !email || !password) {
        alert('Please fill in all fields.');
        return;
      }

      try {
        addUserForm.querySelector('button').disabled = true;

        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        await addDoc(collection(db, 'users'), {
          uid: user.uid,
          name,
          email
        });

        nameInput.value = '';
        emailInput.value = '';
        passwordInput.value = '';
        loadUsers();
      } catch (err) {
        alert('Error adding user: ' + err.message);
      } finally {
        addUserForm.querySelector('button').disabled = false;
      }
    });

    loadUsers();
  </script>
</body>
</html>
